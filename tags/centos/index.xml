<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>centos on Zefrawendi' Site</title><link>https://zefrawendi.github.io/tags/centos/</link><description>Recent content in centos on Zefrawendi' Site</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Thu, 20 Oct 2022 09:45:48 +0800</lastBuildDate><atom:link href="https://zefrawendi.github.io/tags/centos/index.xml" rel="self" type="application/rss+xml"/><item><title>防火墙配置</title><link>https://zefrawendi.github.io/p/firewalld/</link><pubDate>Thu, 20 Oct 2022 09:45:48 +0800</pubDate><guid>https://zefrawendi.github.io/p/firewalld/</guid><description>&lt;h3 id="服务配置">&lt;strong>服务配置&lt;/strong>&lt;/h3>
&lt;ul>
&lt;li>&lt;strong>启动&lt;/strong>： &lt;code>systemctl start firewalld.service&lt;/code>&lt;/li>
&lt;li>&lt;strong>查看状态&lt;/strong>： &lt;code>systemctl status firewalld.service&lt;/code>&lt;/li>
&lt;li>&lt;strong>停止&lt;/strong>： &lt;code>systemctl disable firewalld.service&lt;/code>&lt;/li>
&lt;li>&lt;strong>禁用&lt;/strong>： &lt;code>systemctl stop firewalld.service&lt;/code>&lt;/li>
&lt;/ul>
&lt;h3 id="三种策略">&lt;strong>三种策略&lt;/strong>&lt;/h3>
&lt;ul>
&lt;li>&lt;strong>ACCEPT&lt;/strong> 允许&lt;/li>
&lt;li>&lt;strong>REJECT&lt;/strong> 拒绝&lt;/li>
&lt;li>&lt;strong>DROP&lt;/strong> 丢弃&lt;/li>
&lt;/ul>
&lt;h3 id="1-查看">&lt;strong>1. 查看&lt;/strong>&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看激活的域&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall-cmd --get-active-zones
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看开放的端口&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall-cmd --zone&lt;span class="o">=&lt;/span>public --list-ports
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看开放的服务&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall-cmd --zone&lt;span class="o">=&lt;/span>public --list-services
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看添加的规则&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall-cmd --zone&lt;span class="o">=&lt;/span>public --list-rich-rules
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="2-添加端口">&lt;strong>2. 添加端口&lt;/strong>&lt;/h3>
&lt;h3 id="常用命令">&lt;strong>常用命令&lt;/strong>&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#开放单个端口&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall-cmd --zone&lt;span class="o">=&lt;/span>public --add-port&lt;span class="o">=&lt;/span>80/tcp --permanent
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 开放端口范围&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall-cmd --zone&lt;span class="o">=&lt;/span>public --add-port&lt;span class="o">=&lt;/span>8388-8389/tcp --permanent
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 对 147.152.139.197 开放10000端口&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall-cmd --permanent --add-rich-rule&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;rule family=&amp;#34;&lt;/span>ipv4&lt;span class="s2">&amp;#34; source address=&amp;#34;&lt;/span>147.152.139.197/32&lt;span class="s2">&amp;#34; port protocol=&amp;#34;&lt;/span>tcp&lt;span class="s2">&amp;#34; port=&amp;#34;&lt;/span>10000&lt;span class="s2">&amp;#34; accept&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 拒绝端口：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall-cmd --permanent --zone&lt;span class="o">=&lt;/span>public --add-rich-rule&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39; rule family=&amp;#34;ipv4&amp;#34; source address=&amp;#34;47.52.39.197/32&amp;#34; port protocol=&amp;#34;tcp&amp;#34; port=&amp;#34;10000&amp;#34; reject&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 开放全部端口给IP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall-cmd --permanent --zone&lt;span class="o">=&lt;/span>public --add-rich-rule&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39; rule family=&amp;#34;ipv4&amp;#34; source address=&amp;#34;192.168.0.1/32&amp;#34; accept&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 开放全部端口给网段&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall-cmd --permanent --zone&lt;span class="o">=&lt;/span>public --add-rich-rule&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39; rule family=&amp;#34;ipv4&amp;#34; source address=&amp;#34;192.168.0.0/16&amp;#34; accept&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="3-添加服务">&lt;strong>3. 添加服务&lt;/strong>&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看全部支持的服务&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall-cmd --get-service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看开放的服务&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall-cmd --list-service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 添加服务,添加https&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall-cmd --add-service&lt;span class="o">=&lt;/span>https --permanent
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 修改对应的配置文件是/etc/firewalld/zones/public.xml&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="4-移除端口">&lt;strong>4. 移除端口&lt;/strong>&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 移除添加的端口(其它的增加的策略也是将add改为remove即可)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall-cmd --zone&lt;span class="o">=&lt;/span>public --remove-port&lt;span class="o">=&lt;/span>80/tcp --permanent
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="5-重载配置">&lt;strong>5. 重载配置&lt;/strong>&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 对路由规则进行修改后，需要重新加载规则才能使规则生效&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall-cmd --reload
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="实战应用">&lt;strong>实战应用&lt;/strong>&lt;/h3>
&lt;h3 id="1限制ssh访问仅允许白名单ip登录">&lt;strong>(1)限制ssh访问，仅允许白名单IP登录&lt;/strong>&lt;/h3>
&lt;p>也可以通过在/etc/host.deny里面配置来实现&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 取消默认开启的没有访问限制的ssh服务，让ssh服务默认情况下拒绝连接&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall-cmd --permanent --remove-service&lt;span class="o">=&lt;/span>ssh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 允许特定ip或ip段访问22端口的ssh服务&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall-cmd --permanent --add-rich-rule&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;rule family=&amp;#34;ipv4&amp;#34; source address=&amp;#34;192.168.1.0/24&amp;#34; port protocol=&amp;#34;tcp&amp;#34; port=&amp;#34;22&amp;#34; accept&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 重载firewall配置，使其生效&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall-cmd --reload
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>